import{a as te}from"./chunk-ZNRZW4BI.js";import{a as ie}from"./chunk-V42CKKVT.js";import{a as ne}from"./chunk-GIJA7IEW.js";import"./chunk-224KP37M.js";import{a as x,n as k}from"./chunk-MQVH6ZV5.js";import{$ as j,$a as U,Bb as p,Cc as X,Dc as q,Ec as J,F as D,Fc as Q,Hc as Y,Jb as L,Jc as Z,Ka as l,Kb as _,Lc as ee,Mc as T,Nb as s,Ob as N,P as R,Pb as P,R as W,X as C,Ya as M,aa as c,bb as h,bc as d,cc as b,dc as K,fa as u,ga as g,hb as O,m as V,nb as v,ob as o,pb as a,q as y,qb as A,ub as z,vb as G,xb as F,zb as m}from"./chunk-V4EMFQCR.js";import"./chunk-EQDQRRRY.js";var f={state:x.steering?.autopilot?.state??"steering.autopilot.state",targetHeadingTrue:x.steering?.autopilot?.target?.headingTrue??"steering.autopilot.target.headingTrue",targetHeadingMagnetic:x.steering?.autopilot?.target?.headingMagnetic??"steering.autopilot.target.headingMagnetic",targetWindAngleApparent:x.steering?.autopilot?.target?.windAngleApparent??"steering.autopilot.target.windAngleApparent"};var E=class n{datapointStore=c(k);skClient=c(ie);isConnected$=this.skClient.connected$;state$=this.datapointStore.observe(f.state).pipe(y(e=>e?.value||"standby"),R(1));targetHeadingTrue$=this.datapointStore.observe(f.targetHeadingTrue).pipe(y(e=>e?.value));targetHeadingMagnetic$=this.datapointStore.observe(f.targetHeadingMagnetic).pipe(y(e=>e?.value));targetWindAngle$=this.datapointStore.observe(f.targetWindAngleApparent).pipe(y(e=>e?.value));constructor(){}getSnapshot(e){return this.datapointStore.get(e)?.value}static \u0275fac=function(t){return new(t||n)};static \u0275prov=C({token:n,factory:n.\u0275fac,providedIn:"root"})};var I=class n{constructor(e,t){this.http=e;this.env=t;let i=this.env.signalKBaseUrl.replace(/\/$/,""),w=(i.endsWith("/api")?i.slice(0,-4):i).replace(/\/v1$/,"");this.apiV2Url=`${w}/v2/api`}apiV2Url;putAutopilot(e,t){let i=`${this.apiV2Url}/vessels/self/autopilots/_default/${e}`;return this.http.put(i,t).pipe(D(r=>(console.error(`Error putting autopilot ${e}:`,r),V(()=>r))))}postAutopilot(e){let t=`${this.apiV2Url}/vessels/self/autopilots/_default/${e}`;return this.http.post(t,{}).pipe(D(i=>(console.error(`Error posting autopilot ${e}:`,i),V(()=>i))))}mapMode(e){switch(e){case"wind":return"wind";case"route":return"gps";default:return"compass"}}setMode(e){return this.putAutopilot("mode",{value:e})}engagePilot(){return this.postAutopilot("engage")}disengagePilot(){return this.postAutopilot("disengage")}setState(e){if(e==="standby")return this.disengagePilot();let t=this.mapMode(e);return this.setMode(t).pipe(W(()=>this.engagePilot()))}setTargetHeading(e){return this.putAutopilot("target",{value:e})}setTargetWindAngle(e){return this.putAutopilot("target",{value:e})}engage(e){return this.setState(e)}standby(){return this.setState("standby")}static \u0275fac=function(t){return new(t||n)(j(te),j(ne))};static \u0275prov=C({token:n,factory:n.\u0275fac,providedIn:"root"})};var $=class n{store=c(E);api=c(I);state$=this.store.state$;targetHeadingTrue$=this.store.targetHeadingTrue$;targetHeadingMagnetic$=this.store.targetHeadingMagnetic$;targetWindAngle$=this.store.targetWindAngle$;isConnected$=this.store.isConnected$;setState(e){this.api.setState(e).subscribe()}engageAuto(){this.api.engage("auto").subscribe()}engageWind(){this.api.engage("wind").subscribe()}engageRoute(){this.api.engage("route").subscribe()}standby(){this.api.standby().subscribe()}adjustTarget(e){let t=this.store.getSnapshot(f.state),i=e*(Math.PI/180);if(t==="auto"){let r=this.store.getSnapshot(f.targetHeadingTrue);r!==void 0&&this.api.setTargetHeading(r+i).subscribe()}else if(t==="wind"){let r=this.store.getSnapshot(f.targetWindAngleApparent);r!==void 0&&this.api.setTargetWindAngle(r+i).subscribe()}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=C({token:n,factory:n.\u0275fac,providedIn:"root"})};var H=class n{transform(e,t=0){return e==null?"---":(e*(180/Math.PI)).toFixed(t)}static \u0275fac=function(t){return new(t||n)};static \u0275pipe=U({name:"degrees",type:n,pure:!0})};function re(n,e){n&1&&(o(0,"div",3)(1,"span",4),s(2,"\u26A0\uFE0F"),a(),o(3,"span",5),s(4,"AUTOPILOT DISCONNECTED"),a()())}function se(n,e){if(n&1&&(o(0,"span",31),s(1),d(2,"async"),d(3,"degrees"),a()),n&2){let t=p(2);l(),P(" ",b(3,3,b(2,1,t.facade.targetWindAngle$))," ")}}function le(n,e){if(n&1&&(o(0,"span",31),s(1),d(2,"async"),d(3,"degrees"),a()),n&2){let t=p(2);l(),P(" ",b(3,3,b(2,1,t.facade.targetHeadingTrue$))," ")}}function pe(n,e){if(n&1){let t=F();o(0,"div",32)(1,"button",33),m("click",function(){u(t);let r=p(2);return g(r.facade.adjustTarget(-10))}),s(2," \u25C0\u25C0 10\xB0 "),a(),o(3,"button",34),m("click",function(){u(t);let r=p(2);return g(r.facade.adjustTarget(-1))}),s(4," \u25C0 1\xB0 "),a(),o(5,"button",35),m("click",function(){u(t);let r=p(2);return g(r.facade.adjustTarget(1))}),s(6," 1\xB0 \u25B6 "),a(),o(7,"button",36),m("click",function(){u(t);let r=p(2);return g(r.facade.adjustTarget(10))}),s(8," 10\xB0 \u25B6\u25B6 "),a()()}}function de(n,e){n&1&&(o(0,"div",37),s(1," \u26A0\uFE0F OFF COURSE "),a())}function ce(n,e){if(n&1){let t=F();o(0,"div",6),d(1,"async"),o(2,"div",7)(3,"div",8),A(4,"div",9),o(5,"div",10)(6,"span",11),s(7,"STATUS"),a(),o(8,"span",12),s(9),d(10,"uppercase"),a()()(),o(11,"button",13),m("click",function(){let r=u(t).ngIf,w=p();return g(r!=="standby"?w.facade.standby():w.facade.engageAuto())}),s(12),a()(),o(13,"div",14)(14,"span",15),s(15,"TARGET"),a(),o(16,"div",16),z(17,17),h(18,se,4,5,"span",18)(19,le,4,5,"span",19),G(),o(20,"span",20),s(21),a()()(),h(22,pe,9,0,"div",21),o(23,"div",22)(24,"button",23),m("click",function(){u(t);let r=p();return g(r.facade.engageAuto())}),s(25,"Auto"),a(),o(26,"button",23),m("click",function(){u(t);let r=p();return g(r.facade.engageWind())}),s(27,"Wind"),a(),o(28,"button",23),m("click",function(){u(t);let r=p();return g(r.facade.engageRoute())}),s(29,"Route"),a()(),o(30,"div",24)(31,"span",25),s(32,"RUDDER"),a(),o(33,"div",26),A(34,"div",27)(35,"div",28),a(),o(36,"span",29),s(37),d(38,"number"),a()(),h(39,de,2,0,"div",30),a()}if(n&2){let t=e.ngIf,i=p();_("disabled",!b(1,26,i.facade.isConnected$)),l(3),_("engaged",t!=="standby"),l(6),N(b(10,28,t)),l(2),_("engage-btn--engaged",t!=="standby"),O("aria-label",t!=="standby"?"Disengage autopilot":"Engage autopilot"),l(),P(" ",t!=="standby"?"DISENGAGE":"ENGAGE"," "),l(5),v("ngSwitch",t),l(),v("ngSwitchCase","wind"),l(3),N(t==="wind"?"\xB0AWA":"\xB0T"),l(),v("ngIf",t==="auto"||t==="wind"),l(2),_("active",t==="auto"),O("aria-selected",t==="auto"),l(2),_("active",t==="wind"),O("aria-selected",t==="wind"),l(2),_("active",t==="route"),O("aria-selected",t==="route"),l(7),L("transform","translateX("+i.rudderAngle*2+"px)"),l(2),P("",K(38,30,i.rudderAngle,"1.0-1"),"\xB0"),l(2),v("ngIf",i.isOffCourse)}}var B=class n{facade=c($);store=c(k);rudderAngle=0;isOffCourse=!1;subs=[];OFF_COURSE_THRESHOLD=10;ngOnInit(){this.subs.push(this.store.observe(x.steering.rudderAngle).subscribe({next:e=>{e?.value!=null&&typeof e.value=="number"&&(this.rudderAngle=e.value*(180/Math.PI),this.isOffCourse=Math.abs(this.rudderAngle)>this.OFF_COURSE_THRESHOLD)}}))}ngOnDestroy(){this.subs.forEach(e=>e.unsubscribe())}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-autopilot-console"]],decls:5,vars:6,consts:[[1,"ap-console-wrapper"],["class","disconnected-overlay",4,"ngIf"],["class","ap-console",3,"disabled",4,"ngIf"],[1,"disconnected-overlay"],[1,"icon"],[1,"text"],[1,"ap-console"],[1,"ap-header"],[1,"ap-status"],[1,"status-indicator"],[1,"status-text"],[1,"label"],[1,"value"],[1,"engage-btn",3,"click"],[1,"ap-display"],[1,"ap-display__label"],[1,"ap-display__value-row"],[3,"ngSwitch"],["class","ap-display__value gb-display-value--xl",4,"ngSwitchCase"],["class","ap-display__value gb-display-value--xl",4,"ngSwitchDefault"],[1,"ap-display__unit","gb-display-unit"],["class","ap-dodge",4,"ngIf"],["role","tablist",1,"ap-modes"],["role","tab",1,"mode-btn",3,"click"],[1,"ap-rudder"],[1,"rudder-label"],[1,"rudder-track"],[1,"rudder-center"],[1,"rudder-indicator"],[1,"rudder-value","gb-display-value--sm"],["class","ap-warning",4,"ngIf"],[1,"ap-display__value","gb-display-value--xl"],[1,"ap-dodge"],["aria-label","-10\xB0",1,"dodge-btn","dodge-btn--port-big",3,"click"],["aria-label","-1\xB0",1,"dodge-btn","dodge-btn--port-small",3,"click"],["aria-label","+1\xB0",1,"dodge-btn","dodge-btn--stbd-small",3,"click"],["aria-label","+10\xB0",1,"dodge-btn","dodge-btn--stbd-big",3,"click"],[1,"ap-warning"]],template:function(t,i){t&1&&(o(0,"div",0),h(1,re,5,0,"div",1),d(2,"async"),h(3,ce,40,33,"div",2),d(4,"async"),a()),t&2&&(l(),v("ngIf",!b(2,2,i.facade.isConnected$)),l(2),v("ngIf",b(4,4,i.facade.state$)))},dependencies:[T,X,q,J,Q,Y,Z,ee,H],styles:[".ap-console-wrapper[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;border-radius:12px}.disconnected-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000bf;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);z-index:50;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--warn);font-weight:700;gap:1rem;text-align:center}.disconnected-overlay[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:3rem}.ap-console[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:1.25rem;background:var(--gb-bg-bezel);border-radius:12px;height:100%;transition:filter .3s}.ap-console.disabled[_ngcontent-%COMP%]{pointer-events:none;filter:grayscale(.8) opacity(.5)}.ap-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.ap-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.6rem 1rem;background:var(--gb-bg-panel);border-radius:8px;border-left:4px solid var(--gb-text-muted);flex:1}.ap-status.engaged[_ngcontent-%COMP%]{border-left-color:var(--success, #2ec25c);background:#2ec25c14}.status-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.status-text[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.65rem;color:var(--gb-text-muted);text-transform:uppercase;letter-spacing:.1em}.status-text[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;color:var(--gb-text-value)}.engage-btn[_ngcontent-%COMP%]{padding:.6rem 1.25rem;border:2px solid var(--gb-text-muted);border-radius:8px;background:transparent;color:var(--gb-text-value);font-weight:700;font-size:.85rem;cursor:pointer;transition:all .2s;white-space:nowrap}.engage-btn[_ngcontent-%COMP%]:hover{border-color:var(--gb-needle-secondary);color:var(--gb-needle-secondary)}.engage-btn--engaged[_ngcontent-%COMP%]{border-color:var(--status-offline, #f06352);color:var(--status-offline, #f06352);background:#f063521a}.ap-display[_ngcontent-%COMP%]{text-align:center;padding:.75rem 0}.ap-display__label[_ngcontent-%COMP%]{font-size:.65rem;color:var(--gb-text-muted);text-transform:uppercase;letter-spacing:.1em;display:block;margin-bottom:.25rem}.ap-display__value-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;gap:.35rem}.ap-display__value[_ngcontent-%COMP%]{font-size:3rem;font-family:var(--font-mono, monospace);font-weight:700;line-height:1}.ap-display__unit[_ngcontent-%COMP%]{font-size:.85rem;color:var(--gb-text-muted)}.ap-dodge[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.35rem}.dodge-btn[_ngcontent-%COMP%]{background:var(--gb-bg-panel);border:1px solid var(--border);color:var(--gb-text-value);font-family:var(--font-mono, monospace);font-weight:700;font-size:.8rem;padding:.7rem .25rem;border-radius:8px;cursor:pointer;touch-action:manipulation;min-height:44px;transition:all .15s}.dodge-btn[_ngcontent-%COMP%]:active{background:var(--accent, #5ba4cf);color:#fff;transform:scale(.95)}.dodge-btn--port-big[_ngcontent-%COMP%], .dodge-btn--port-small[_ngcontent-%COMP%]{color:#f06352}.dodge-btn--stbd-small[_ngcontent-%COMP%], .dodge-btn--stbd-big[_ngcontent-%COMP%]{color:#2ec25c}.ap-modes[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.35rem;background:var(--gb-bg-panel);padding:.25rem;border-radius:8px}.mode-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--gb-text-muted);padding:.65rem .5rem;border-radius:6px;font-weight:600;cursor:pointer;transition:all .2s;min-height:44px}.mode-btn[_ngcontent-%COMP%]:hover{background:#ffffff0d;color:var(--gb-text-value)}.mode-btn.active[_ngcontent-%COMP%]{background:var(--accent, #5ba4cf);color:#fff;box-shadow:0 2px 4px #0003}.ap-rudder[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem 1rem;background:var(--gb-bg-panel);border-radius:8px}.rudder-label[_ngcontent-%COMP%]{font-size:.65rem;color:var(--gb-text-muted);text-transform:uppercase;letter-spacing:.08em;flex-shrink:0}.rudder-track[_ngcontent-%COMP%]{flex:1;height:4px;background:var(--surface-3, var(--border));border-radius:2px;position:relative}.rudder-center[_ngcontent-%COMP%]{position:absolute;left:50%;top:-3px;width:2px;height:10px;background:var(--gb-text-muted);transform:translate(-50%)}.rudder-indicator[_ngcontent-%COMP%]{position:absolute;left:calc(50% - 5px);top:-3px;width:10px;height:10px;border-radius:50%;background:var(--accent, #5ba4cf);transition:transform .3s cubic-bezier(.4,0,.2,1)}.rudder-value[_ngcontent-%COMP%]{font-family:var(--font-mono, monospace);font-variant-numeric:tabular-nums;min-width:3ch;text-align:right}.ap-warning[_ngcontent-%COMP%]{padding:.65rem 1rem;background:#f0635226;border:1px solid rgba(240,99,82,.5);border-radius:8px;color:var(--status-offline, #f06352);font-weight:700;text-align:center;animation:_ngcontent-%COMP%_pulse-alert 2s infinite}@keyframes _ngcontent-%COMP%_pulse-alert{0%,to{opacity:1}50%{opacity:.6}}"]})};var oe=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-autopilot-page"]],decls:7,vars:0,consts:[[1,"page-container"],[1,"page-header"],[1,"page-content"],[1,"console-wrapper"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"header",1)(2,"h1"),s(3,"Autopilot"),a()(),o(4,"div",2)(5,"div",3),A(6,"app-autopilot-console"),a()()())},dependencies:[T,B],styles:[".page-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;padding:var(--layout-gap);gap:var(--layout-gap)}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--gb-text-value)}.page-content[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:flex-start}.console-wrapper[_ngcontent-%COMP%]{width:100%;max-width:500px;aspect-ratio:4/5}"]})};export{oe as AutopilotPage};
