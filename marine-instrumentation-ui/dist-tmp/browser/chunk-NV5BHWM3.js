import{X as u,g,q as c}from"./chunk-V4EMFQCR.js";import{a as s,b as l}from"./chunk-EQDQRRRY.js";var v={"anchor-watch":"anchor","shallow-water":"navigation","cpa-warning":"collision",mob:"mob","battery-low":"electrical","gps-lost":"system","off-route":"navigation","engine-overheat":"engine","low-oil":"engine","storm-warning":"environment","connection-lost":"system"};var A=class m{_alarms=new g(new Map);alarms$=this._alarms.asObservable().pipe(c(r=>Array.from(r.values()).sort((t,e)=>e.timestamp-t.timestamp)));activeAlarms$=this.alarms$.pipe(c(r=>r.filter(t=>t.state==="active"||t.state==="acknowledged"||t.state==="silenced")));highestSeverity$=this.activeAlarms$.pipe(c(r=>r.some(t=>t.severity==="emergency")?"emergency":r.some(t=>t.severity==="critical")?"critical":r.some(t=>t.severity==="warning")?"warning":null));constructor(){}triggerAlarm(r,t,e,n,a){let o=this._alarms.value,i=o.get(r);if(i?.state==="inhibited")return;if(i&&(i.state==="active"||i.state==="acknowledged"||i.state==="silenced")){if(this.isSeverityHigher(e,i.severity)){this.updateAlarmState(i,"active",s({severity:e,message:n,timestamp:Date.now()},a!==void 0?{data:a}:{}));return}if(i.message!==n||JSON.stringify(i.data)!==JSON.stringify(a)){let y=s(l(s({},i),{message:n}),a!==void 0?{data:a}:{}),p=new Map(o);p.set(r,y),this._alarms.next(p)}return}let f=v[t]??"system",h=l(s({id:r,type:t,category:f,severity:e,state:"active",message:n},a!==void 0?{data:a}:{}),{timestamp:Date.now()}),d=new Map(o);d.set(r,h),this._alarms.next(d)}acknowledgeAlarm(r){let e=this._alarms.value.get(r);e&&e.state==="active"&&this.updateAlarmState(e,"acknowledged")}silenceAlarm(r){let e=this._alarms.value.get(r);e&&(e.state==="active"||e.state==="acknowledged")&&this.updateAlarmState(e,"silenced")}clearAlarm(r){let e=this._alarms.value.get(r);e&&e.state!=="cleared"&&e.state!=="inactive"&&this.updateAlarmState(e,"cleared")}resolveAlarm(r){let e=this._alarms.value.get(r);e&&(e.state==="active"||e.state==="acknowledged"||e.state==="silenced")&&this.updateAlarmState(e,"resolved",{resolvedAt:Date.now()})}inhibitAlarm(r){let e=this._alarms.value.get(r);e&&this.updateAlarmState(e,"inhibited")}acknowledgeAll(){let r=this._alarms.value,t=new Map(r),e=!1;for(let[n,a]of t)a.state==="active"&&(t.set(n,l(s({},a),{state:"acknowledged",acknowledgedAt:Date.now()})),e=!0);e&&this._alarms.next(t)}silenceAll(){let r=this._alarms.value,t=new Map(r),e=!1;for(let[n,a]of t)(a.state==="active"||a.state==="acknowledged")&&(t.set(n,l(s({},a),{state:"silenced"})),e=!0);e&&this._alarms.next(t)}clearAll(){this._alarms.next(new Map)}updateAlarmState(r,t,e={}){let n=this._alarms.value,a=s(l(s({},r),{state:t}),e),o=new Map(n);o.set(r.id,a),this._alarms.next(o)}isSeverityHigher(r,t){let e={info:0,warning:1,critical:2,emergency:3};return e[r]>e[t]}static \u0275fac=function(t){return new(t||m)};static \u0275prov=u({token:m,factory:m.\u0275fac,providedIn:"root"})};export{A as a};
