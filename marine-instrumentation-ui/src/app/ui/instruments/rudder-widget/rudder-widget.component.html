<app-instrument-card
  title="RUDDER"
  [quality]="view().quality"
  [ageSeconds]="view().age"
  [source]="view().source"
>
  <div class="rudder-container">
    
    <!-- VISUALIZACIÓN GRÁFICA (ARCO) -->
    <div class="scale-view">
      <svg viewBox="0 0 200 120" preserveAspectRatio="xMidYMax" class="rudder-svg">
        <defs>
          <linearGradient id="arc-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#ff3d00" stop-opacity="0.8"/> <!-- Red Port -->
            <stop offset="50%" stop-color="#00e5ff" stop-opacity="0.2"/> <!-- Center -->
            <stop offset="100%" stop-color="#00e676" stop-opacity="0.8"/> <!-- Green Stbd -->
          </linearGradient>
          <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Pista del arco (Fondo) -->
        <path d="M 10 110 A 90 90 0 0 1 190 110" class="scale-track-bg" />

        <!-- Pista del arco (Gradiante) -->
        <path d="M 10 110 A 90 90 0 0 1 190 110" class="scale-track" stroke="url(#arc-gradient)" />

        <!-- Marcas de escala -->
        <g class="ticks">
           <!-- Centro -->
           <line x1="100" y1="100" x2="100" y2="115" class="tick-mark center-tick" />
           <!-- 40 Port (Izquierda) -->
           <line x1="18.5" y1="65" x2="26" y2="70" class="tick-mark" />
           <text x="15" y="60" class="tick-label port-text">40</text>
           <!-- 40 Stbd (Derecha) -->
           <line x1="181.5" y1="65" x2="174" y2="70" class="tick-mark" />
           <text x="185" y="60" class="tick-label stbd-text">40</text>
        </g>

        <!-- Indicador Móvil (Needle) -->
        <g class="indicator-group" [style.transform]="getRotationTransform(view().angleDegrees)">
          <!-- Triángulo indicador -->
          <path d="M 100 25 L 95 45 L 105 45 Z" class="needle-head" filter="url(#glow)" />
          <!-- Línea hasta el pivote -->
          <line x1="100" y1="45" x2="100" y2="105" class="needle-shaft" />
          <!-- Pivote -->
          <circle cx="100" cy="110" r="4" class="needle-pivot" />
        </g>

      </svg>
    </div>

    <!-- LECTURA DIGITAL -->
    <div class="readout-panel">
      <div class="digital-value" [ngClass]="{
        'port': view().side === 'PORT', 
        'stbd': view().side === 'STBD'
      }">
        {{ view().absAngle | number:'1.0-1' }}°
      </div>
      
      <div class="readout-label">
        <span class="side-indicator" [class.active-port]="view().side === 'PORT'" [class.active-stbd]="view().side === 'STBD'">
          {{ view().side === 'CENTER' ? 'MID' : view().side }}
        </span>
      </div>
    </div>

  </div>
</app-instrument-card>
